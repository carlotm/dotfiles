# SYSTEM PACKAGES {{{
- name: FORCE REMOVE PACKAGES
  become: yes
  become_method: ansible.builtin.su
  community.general.pacman:
    pkg:
    - lftp
    state: absent
- name: INSTALL PACKAGES
  become: yes
  become_method: ansible.builtin.su
  community.general.pacman:
    pkg:
    - alacritty
    - ansible
    - base
    - base-devel
    - bash-completion
    - bat
    - curl
    - elementary-icon-theme
    - eza
    - fd
    - firefox
    - fontconfig
    - fzf
    - gdu
    - git
    - inotify-tools
    - keepass
    - libnotify
    - noto-fonts
    - noto-fonts-emoji
    - openssh
    - pavucontrol
    - pulseaudio
    - ripgrep
    - starship
    - stow
    - sudo
    - vim
    - wget
    - xfce4
    - xfce4-goodies
    - xorg
    - xorg-xinit
    update_cache: true
# }}}

# USER AND GROUPS {{{
- name: CREATE BASE GROUPS
  become: yes
  become_method: ansible.builtin.su
  ansible.builtin.group:
    name: "{{ item }}"
    state: present
  loop:
    - users
    - carloratm
- name: SET USER
  become: yes
  become_method: ansible.builtin.su
  ansible.builtin.user:
    name: carloratm
    shell: /bin/bash
    groups:
      - users
      - disk
      - adm
      - audio
      - video
      - disk
      - sys
      - tty
      - daemon
      - input
- name: ADD USER TO SUDOERS
  become: yes
  become_method: ansible.builtin.su
  community.general.sudoers:
    name: sudo
    state: present
    user: carloratm
    commands: ALL
# }}}

# SYSTEM CONFIG {{{
- name: SET HOSTNAME
  become: yes
  ansible.builtin.hostname:
    name: "{{ host }}"
- name: SET TIMEZONE
  become: yes
  community.general.timezone:
    name: Europe/Vienna
- name: COPY LOCALE CONF
  become: yes
  ansible.builtin.copy:
    src: "templates/{{ host }}/etc/locale.conf"
    dest: /etc/locale.conf
    owner: root
    group: root
    mode: "0644"
- name: COPY TIMEZONE
  become: yes
  ansible.builtin.copy:
    src: "templates/{{ host }}/etc/timezone"
    dest: /etc/timezone
    owner: root
    group: root
    mode: "0644"
- name: GENERATE LOCALES
  become: yes
  community.general.locale_gen:
    name: "{{ item }}"
    state: present
  loop:
    - en_US.UTF-8
    - it_IT.UTF-8
    - de_DE.UTF-8
# }}}

# GIT CONFIG {{{
- name: SET GIT CONFIG
  community.general.git_config:
    name: "{{ item.name }}"
    scope: global
    value: "{{ item.value }}"
  loop:
    - {name: user.name, value: "Ascani Carlo"}
    - {name: alias.co, value: checkout}
    - {name: alias.s, value: status}
    - {name: init.defaultBranch, value: main}
- name: SET GIT EMAIL
  community.general.git_config:
    name: user.email
    scope: global
    value: "{{ email }}"
# }}}

# DOTFILES {{{
- name: STOW DOTFILES
  ansible.builtin.shell: stow "{{ host }}" --target="{{lookup('env', 'HOME')}}"
  args:
    chdir: dotfiles
# }}}

# SERVICES {{{
- name: SERVICES
  become: yes
  ansible.builtin.service:
    name: "{{ item }}"
    state: started
    enabled: yes
  loop:
    - sshd
# }}}

# FONTS {{{
- name: COPY CONSOLE FONTS
  become: yes
  ansible.builtin.copy:
    src: "templates/{{ host }}/usr/share/kbd/consolefonts/{{ item }}"
    dest: /usr/share/kbd/consolefonts/
    owner: root
    group: root
    mode: "0644"
  loop:
    - spleen-5x8.psfu
    - spleen-6x12.psfu
    - spleen-8x16.psfu
    - spleen-12x24.psfu
    - spleen-16x32.psfu
    - spleen-32x64.psfu
- name: COPY VCONSOLE CONF
  become: yes
  ansible.builtin.copy:
    src: "templates/{{ host }}/etc/vconsole.conf"
    dest: /etc/vconsole.conf
    owner: root
    group: root
    mode: "0644"
- name: UPDATE FONT CACHE
  ansible.builtin.command: fc-cache -fv
# }}}
