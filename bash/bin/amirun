#!/bin/bash

set -e

MONAM=false

while getopts d option
do
    case "${option}"
    in
        d) MONAM=true;;
        *) ;;
    esac
done

vasmm68k_mot -Fhunkexe -o main.exe -nosym main.asm

FSUAE_BASE_DIR="${HOME}/FS-UAE"
FSUAE_CONF="${FSUAE_BASE_DIR}/Configurations/a600dev.fs-uae"
WB_DIR="${FSUAE_BASE_DIR}/Hard Drives/WorkbenchDev"
SSEQ="/S/Startup-sequence"
CWD=${PWD##*/}

if [ "$MONAM" = true ] ; then
    MONAM_CMD="DEV:MonAm\/MonAm "
else
    MONAM_CMD=""
fi

sed "${WB_DIR}${SSEQ}.template" -e "s/; AUTORUN ;/${MONAM_CMD}DEV:${CWD}\/main.exe/" > "${WB_DIR}${SSEQ}"

fs-uae "$FSUAE_CONF"